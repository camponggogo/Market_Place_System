<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ข้อตกลงการรับชำระอิสระ (P2P Contract)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=TH+Sarabun+New:wght@400;700&display=swap');
        
        * {
            font-family: 'TH Sarabun New', sans-serif;
        }
        
        body {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
            font-size: 18px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        h2 {
            color: #555;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .important {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        
        .disclaimer {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 20px 0;
        }
        
        ul {
            padding-left: 25px;
        }
        
        li {
            margin-bottom: 10px;
        }
        
        .signature-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid #ddd;
        }
        
        .checkbox-container {
            margin: 30px 0;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        
        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        
        .checkbox-container label {
            font-size: 18px;
            font-weight: bold;
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>ข้อตกลงการรับชำระอิสระ (P2P Payment Agreement)</h1>
    
    <div class="section">
        <p><strong>วันที่:</strong> <span id="contract-date"></span></p>
        <p><strong>ร้านค้า:</strong> <span id="store-name"></span></p>
        <p><strong>เลขประจำตัวผู้เสียภาษี:</strong> <span id="store-tax-id"></span></p>
    </div>

    <div class="disclaimer">
        <h2>คำชี้แจงสำคัญ</h2>
        <p><strong>เจ้าของระบบ Food Court Management System เป็นเพียง "ผู้ให้บริการซอฟต์แวร์แสดงผลข้อมูล Blockchain" เท่านั้น</strong></p>
        <p>ระบบนี้ไม่ใช่ผู้ให้บริการรับชำระเงิน (Payment Gateway) และไม่ใช่ผู้ให้บริการ e-Money</p>
    </div>

    <div class="section">
        <h2>1. วัตถุประสงค์</h2>
        <p>ข้อตกลงฉบับนี้กำหนดเงื่อนไขการใช้งานระบบแสดงผลข้อมูล Blockchain Transaction สำหรับการรับชำระเงินแบบ Peer-to-Peer (P2P) ระหว่างลูกค้าและร้านค้า</p>
    </div>

    <div class="section">
        <h2>2. บทบาทและความรับผิดชอบ</h2>
        <h3>2.1 เจ้าของระบบ Food Court Management System</h3>
        <ul>
            <li>เป็นผู้ให้บริการซอฟต์แวร์แสดงผลข้อมูล Transaction จาก Public Blockchain Explorer</li>
            <li>ไม่ใช่ผู้ให้บริการรับชำระเงิน (Payment Gateway)</li>
            <li>ไม่ใช่ผู้ให้บริการ e-Money หรือ Digital Wallet</li>
            <li>ไม่รับผิดชอบต่อการโอนเงินหรือการชำระเงินระหว่างลูกค้าและร้านค้า</li>
            <li>ไม่รับผิดชอบต่อมูลค่าของ Cryptocurrency หรือความผันผวนของราคา</li>
        </ul>

        <h3>2.2 ร้านค้า</h3>
        <ul>
            <li>รับผิดชอบในการตัดสินใจรับชำระเงินด้วย Cryptocurrency ตามความสมัครใจ</li>
            <li>รับผิดชอบต่อการตรวจสอบและยืนยันการโอนเงินจากลูกค้า</li>
            <li>รับผิดชอบต่อการจัดการความเสี่ยงด้าน Cryptocurrency เอง</li>
            <li>รับผิดชอบต่อการปฏิบัติตามกฎหมายและระเบียบที่เกี่ยวข้อง</li>
            <li>รับผิดชอบต่อการออกใบกำกับภาษีและรายงานภาษีที่เกี่ยวข้อง</li>
        </ul>

        <h3>2.3 ลูกค้า</h3>
        <ul>
            <li>รับผิดชอบต่อการโอนเงิน Cryptocurrency ไปยังที่อยู่ Blockchain ที่ร้านค้ากำหนด</li>
            <li>รับผิดชอบต่อการตรวจสอบความถูกต้องของที่อยู่ Blockchain ก่อนโอนเงิน</li>
            <li>รับผิดชอบต่อการจัดการความเสี่ยงด้าน Cryptocurrency เอง</li>
        </ul>
    </div>

    <div class="section">
        <h2>3. การให้บริการ</h2>
        <h3>3.1 บริการที่ให้</h3>
        <ul>
            <li>ซอฟต์แวร์แสดงผลข้อมูล Transaction Status จาก Public Blockchain Explorer</li>
            <li>Interface สำหรับร้านค้าในการตรวจสอบสถานะการโอนเงิน</li>
            <li>API สำหรับดึงข้อมูล Transaction Status</li>
        </ul>

        <h3>3.2 บริการที่ไม่อยู่ในขอบเขต</h3>
        <ul>
            <li>การรับชำระเงิน (Payment Processing)</li>
            <li>การเก็บเงินหรือจัดการเงินของลูกค้า</li>
            <li>การรับประกันการโอนเงิน</li>
            <li>การจัดการ Wallet หรือ Private Key</li>
        </ul>
    </div>

    <div class="section">
        <h2>4. ค่าบริการ</h2>
        <h3>4.1 Transaction Fee</h3>
        <p>เก็บค่า Service Fee เป็นรายรายการ (เช่น 5-10 บาทต่อครั้ง) ในฐานะค่าบริการ API/Node Interface</p>

        <h3>4.2 Flat Fee</h3>
        <p>เก็บแบบเหมาจ่ายรายเดือนเป็นค่า "Crypto Gateway Information Service"</p>

        <h3>4.3 ใบกำกับภาษี</h3>
        <p>ระบบจะออกใบกำกับภาษีเฉพาะ "ค่าบริการระบบ" ที่เรียกเก็บจากร้านค้าเท่านั้น</p>
        <p><strong>ระบบจะไม่ออกใบกำกับภาษีในส่วนของมูลค่า Cryptocurrency</strong></p>
    </div>

    <div class="section">
        <h2>5. การจำกัดความรับผิดชอบ</h2>
        <ul>
            <li>ระบบไม่รับผิดชอบต่อความเสียหายที่เกิดจากการโอนเงิน Cryptocurrency</li>
            <li>ระบบไม่รับผิดชอบต่อความผันผวนของราคา Cryptocurrency</li>
            <li>ระบบไม่รับผิดชอบต่อการสูญหายของเงิน Cryptocurrency</li>
            <li>ระบบไม่รับผิดชอบต่อการถูกโจมตีหรือการละเมิดความปลอดภัยของ Blockchain Network</li>
            <li>ระบบไม่รับประกันความถูกต้องของข้อมูลจาก Blockchain Explorer (ข้อมูลแสดงตามที่ได้รับจาก Public API)</li>
        </ul>
    </div>

    <div class="section">
        <h2>6. การยกเลิกและแก้ไข</h2>
        <p>ร้านค้าสามารถยกเลิกการใช้งานบริการได้ทุกเมื่อ โดยแจ้งล่วงหน้า 30 วัน</p>
        <p>เจ้าของระบบสามารถแก้ไขข้อตกลงนี้ได้ โดยจะแจ้งให้ร้านค้าทราบล่วงหน้า 30 วัน</p>
    </div>

    <div class="section">
        <h2>7. กฎหมายที่ใช้บังคับ</h2>
        <p>ข้อตกลงนี้อยู่ภายใต้กฎหมายของประเทศไทย และให้ศาลไทยเป็นผู้มีอำนาจชำระคดี</p>
    </div>

    <div class="important">
        <h2>ข้อตกลงสำคัญ</h2>
        <p>โดยการยอมรับข้อตกลงนี้ ร้านค้ายืนยันว่า:</p>
        <ul>
            <li>ได้อ่านและเข้าใจข้อตกลงทั้งหมดแล้ว</li>
            <li>ยอมรับว่าการรับชำระเงินด้วย Cryptocurrency เป็นการตัดสินใจของร้านค้าเอง</li>
            <li>ยอมรับว่าเจ้าของระบบเป็นเพียงผู้ให้บริการซอฟต์แวร์แสดงผลข้อมูลเท่านั้น</li>
            <li>ยอมรับความเสี่ยงทั้งหมดที่เกี่ยวข้องกับการรับชำระเงินด้วย Cryptocurrency</li>
        </ul>
    </div>

    <div class="signature-section">
        <div class="checkbox-container">
            <input type="checkbox" id="agree-checkbox" onchange="toggleAcceptButton()">
            <label for="agree-checkbox">
                ฉันได้อ่านและเข้าใจข้อตกลงทั้งหมดแล้ว และยอมรับข้อตกลงนี้
            </label>
        </div>
        
        <button id="accept-button" onclick="acceptContract()" disabled>
            ยอมรับข้อตกลง
        </button>
    </div>

    <script>
        // Set current date
        document.getElementById('contract-date').textContent = new Date().toLocaleDateString('th-TH', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // Get store info from URL or API
        const urlParams = new URLSearchParams(window.location.search);
        const storeId = urlParams.get('store_id');
        
        // TODO: Fetch store info from API
        // For now, use placeholder
        document.getElementById('store-name').textContent = 'ร้านค้า (จะดึงจาก API)';
        document.getElementById('store-tax-id').textContent = 'XXXXXXXXXXXXX (จะดึงจาก API)';

        function toggleAcceptButton() {
            const checkbox = document.getElementById('agree-checkbox');
            const button = document.getElementById('accept-button');
            button.disabled = !checkbox.checked;
        }

        async function acceptContract() {
            const checkbox = document.getElementById('agree-checkbox');
            if (!checkbox.checked) {
                alert('กรุณาตรวจสอบช่องยอมรับข้อตกลง');
                return;
            }

            const contractVersion = '1.0'; // Get from config or API
            
            try {
                const response = await fetch('/api/stores/accept-contract', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        store_id: storeId,
                        contract_version: contractVersion
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('ยอมรับข้อตกลงเรียบร้อยแล้ว');
                    // Redirect to store dashboard
                    window.location.href = `/stores/${storeId}/dashboard`;
                } else {
                    const error = await response.json();
                    alert('เกิดข้อผิดพลาด: ' + error.detail);
                }
            } catch (error) {
                alert('เกิดข้อผิดพลาดในการเชื่อมต่อ: ' + error.message);
            }
        }
    </script>
</body>
</html>

